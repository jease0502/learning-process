---
tags: linux
---
# `vi` —— 終端中的編輯器

## 目標

* `vi` 簡介
* 打開和新建文件
* 三種工作模式
* 常用命令
* 分屏命令
* 常用命令速查圖

## `vi` 簡介

### 學習 `vi` 的目的

* 在工作中，要對 **服務器** 上的文件進行 **簡單** 的修改，可以使用 `ssh` 遠程登錄到服務器上，並且使用 `vi` 進行快速的編輯即可
* 常見需要修改的文件包括：
    * **源程序**
    * **配置文件**，例如 `ssh` 的配置文件 `~/.ssh/config`
    
> * 在沒有圖形界面的環境下，要編輯文件，`vi` 是最佳選擇！
> * 每一個要使用 Linux 的程序員，都應該或多或少的學習一些 `vi` 的常用命令

### vi 和 vim

* 在很多 `Linux` 發行版中，直接把 `vi` 做成 `vim` 的軟連接

#### vi

* `vi` 是 `Visual interface` 的簡稱，是 `Linux` 中 **最經典** 的文本編輯器
* `vi` 的核心設計思想 —— **讓程序員的手指始終保持在鍵盤的核心區域，就能完成所有的編輯操作**

* `vi` 的特點：
    * **沒有圖形界面** 的 **功能強大** 的編輯器
    * 只能是編輯 **文本內容**，不能對字體、段落進行排版
    * **不支持鼠標操作**
    * **沒有菜單**
    * **只有命令**
* `vi` 編輯器在 **系統管理**、**服務器管理** 編輯文件時，**其功能永遠不是圖形界面的編輯器能比擬的**
 
#### `vim`

**vim = vi improved**

* `vim` 是從`vi` 發展出來的一個文本編輯器，支持**代碼補全**、**編譯** 及**錯誤跳轉** 等方便編程的功能特別豐富，在程序員中被廣泛使用，被稱為**編輯器之神**

#### 查詢軟連接命令（知道）

* 在很多 `Linux` 發行版中直接把 `vi` 做成 `vim` 的軟連接

```bash
# 查找 vi 的運行文件

$ which vi
$ ls -l /usr/bin/vi
$ ls -l /etc/alternatives/vi
$ ls -l /usr/bin/vim.basic

# 查找 vim 的運行文件
$ which vim
$ ls -l /usr/bin/vim
$ ls -l /etc/alternatives/vim
$ ls -l /usr/bin/vim.basic
```

## 打開和新建文件

* 在終端中輸入 `vi` **在後面跟上文件名** 即可

```bash
$ vi 文件名
```

* 如果文件已經存在，會直接打開該文件
* 如果文件不存在，會新建一個文件

### 打開文件並且定位行

* 在日常工作中，有可能會遇到 **打開一個文件，並定位到指定行** 的情況
* 例如：在開發時，**知道某一行代碼有錯誤**，可以 **快速定位** 到出錯代碼的位置

* 這個時候，可以使用以下命令打開文件

```bash
$ vi 文件名 +行數
```

> 提示：如果只帶上 `+` 而不指定行號，會直接定位到文件末尾

### 異常處理

* 如果 `vi` 異常退出，在磁盤上可能會保存有 **交換文件**
* 下次再使用 `vi` 編輯該文件時，會看到以下屏幕信息，按下字母 `d` 可以 **刪除交換文件** 即可

> 提示：按下鍵盤時，注意關閉輸入法



## 三種工作模式

* `vi` 有三種基本工作模式：
    
    1. **命令模式**
        * **打開文件首先進入命令模式**，是使用 `vi` 的 **入口**
        * 通過 **命令** 對文件進行常規的編輯操作，例如：**定位**、**翻頁**、**複製**、**粘貼**、**刪除**……
        * 在其他圖形編輯器下，通過 **快捷鍵** 或者 **鼠標** 實現的操作，都在 **命令模式** 下實現
    2. **末行模式** —— 執行 **保存**、**退出** 等操作
        * 要退出 `vi` 返回到控制台，需要在末行模式下輸入命令
        * **末行模式** 是 `vi` 的 **出口**
    3. **編輯模式** —— 正常的編輯文字
    


> 提示：在 `Touch Bar` 的 Mac 電腦上 ，按 `ESC` 不方便，可以使用 `CTRL + [` 替代

### 末行模式命令
    
| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| w | write | 保存 |
| q | quit | 退出，如果沒有保存，不允許退出 |
| q! | quit | 強行退出，不保存退出 |
| wq | write & quit | 保存並退出 |
| x | | 保存並退出 |
    
## 04. 常用命令

### 命令線路圖

0. 重複次數
    * 在命令模式下，**先輸入一個數字**，**再跟上一個命令**，可以讓該命令 **重複執行指定次數**
1. 移動和選擇（**多練**）
    * `vi` 之所以快，關鍵在於 **能夠快速定位到要編輯的代碼行**
    * **移動命令** 能夠 和 **編輯操作** 命令 **組合使用**
2. 編輯操作
    * **刪除**、**複製**、**粘貼**、**替換**、**縮排**
3. 撤銷和重複
4. 查找替換
5. 編輯

#### 學習提示
 
1. `vi` 的命令較多，**不要期望一下子全部記住**，個別命令忘記了，只是會影響編輯速度而已
2. 在使用 `vi` 命令時，注意 **關閉中文輸入法**

### 移動（基本）

* 要熟練使用 `vi`，首先應該學會怎麼在 **命令模式** 下樣快速移動光標
* **編輯操作命令**，能夠和 **移動命令** 結合在一起使用
    
#### 1) 上、下、左、右

| 命令 | 功能 | 手指 |
| :---: | --- | :---: |
| h | 向左 | 食指 |
| j | 向下 | 食指 |
| k | 向上 | 中指 |
| l | 向右 | 無名指 |



#### 2) 行內移動

| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| w | word | 向後移動一個單詞 |
| b | back | 向前移動一個單詞 |
| 0 | | 行首 |
| ^ | | 行首，第一個不是空白字符的位置 |
| $ | | 行尾 |

#### 3) 行數移動

| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| gg | go | 文件頂部 |
| G | go | 文件末尾 |
| 數字gg | go | 移動到 數字 對應行數 |
| 數字G | go | 移動到 數字 對應行數 |
| :數字 | | 移動到 數字 對應行數 |

#### 4) 屏幕移動

| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| Ctrl + b | back | 向上翻頁 |
| Ctrl + f | forward | 向下翻頁 |
| H | Head | 屏幕頂部 |
| M | Middle | 屏幕中間 |
| L | Low | 屏幕底部 |

### 移動（程序）

#### 1) 段落移動

* `vi` 中使用 空行 來區分段落
* 在程序開發時，通常 **一段功能相關的代碼會寫在一起** —— 之間沒有空行

| 命令 | 功能 |
| :---: | --- |
| { | 上一段 |
| } | 下一段 |

#### 2) 括號切換

* 在程序世界中，`()`、`[]`、`{}` 使用頻率很高，而且 **都是成對出現的**

| 命令 | 功能 |
| :---: | --- |
| % | 括號匹配及切換 |

#### 3) 標記

* 在開發時，某一塊代碼可能**需要稍後處理**，例如：編輯、查看
* 此時先使用 `m` 增加一個標記，這樣可以 **在需要時快速地跳轉回來** 或者 **執行其他編輯操作**
* **標記名稱** 可以是 `a~z` 或者 `A~Z` 之間的任意 **一個** 字母
* 添加了標記的 **行如果被刪除**，**標記同時被刪除**
* 如果 **在其他行添加了相同名稱的標記**，**之前添加的標記也會被替換掉**

| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| mx | mark | 添加標記 x，x 是 a~z 或者 A~Z 之間的任意一個字母 |
| 'x | | 直接定位到標記 x 所在位置 |

### 選中文本（可視模式）

* 學習 `複製` 命令前，應該先學會 **怎麼樣選中 要復制的代碼**
* 在 `vi` 中要選擇文本，需要先使用 `Visual` 命令切換到 **可視模式**
* `vi` 中提供了 **三種** 可視模式，可以方便程序員選擇 **選中文本的方式**
* 按 `ESC` 可以放棄選中，返回到 **命令模式**

| 命令 | 模式 | 功能 |
| :---: | --- | --- |
| v | 可視模式 | 從光標位置開始按照正常模式選擇文本 |
| V | 可視行模式 | 選中光標經過的完整行 |
| Ctrl + v | 可視塊模式 | 垂直方向選中文本 |

* **可視模式**下，可以和 **移動命令** 連用，例如：`ggVG` 能夠選中所有內容

### 撤銷和恢復撤銷

* 在學習編輯命令之前，先要知道怎樣撤銷之前一次 **錯誤的** 編輯動作！

| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| u | undo | 撤銷上次命令 |
| CTRL + r | redo | 恢復撤銷的命令 |

### 刪除文本

| 命令 | 英文 | 功能 |
| :---: | :---: | --- |
| x | cut | 刪除光標所在字符，或者選中文字 |
| d(移動命令) | delete | 刪除移動命令對應的內容 |
| dd | delete | 刪除光標所在行，可以 ndd 複製多行 |
| D | delete | 刪除至行尾 |

> 提示：如果使用 **可視模式** 已經選中了一段文本，那麼無論使用 `d` 還是 `x`，都可以刪除選中文本

* 刪除命令可以和 **移動命令** 連用，以下是常見的組合命令：

```
* dw