---
tags: 計概
---
# 第十三章檔案結構

## 簡介

檔案儲存在稱為輔助或次要儲存設備之中，最常見的兩種次要儲存體是磁碟和磁帶，在次要儲存體中的檔案可以被讀取及寫入。檔案是資料紀錄的集合。
存取方法決定了紀錄如何被檢索：循序或隨機。

![](https://i.imgur.com/UkJUICH.png)

## 循序存取

- 只能從開始到結束一筆一筆依序讀取，在最後一筆會跳出一個檔案結束(EOF)

![](https://i.imgur.com/X4xZVXh.png)

### 更新循環檔案

- 新主檔
	- 新的永久資料檔案，或是如一般所知含有目前資料的新主檔
- 舊主檔
	- 應該被更新的永久檔案，甚至於更新之後，應該保留舊主檔以供參考用。
- 交易檔
	- 包含要對主檔所做的改變
	- 增加交易
		- 包括一筆新紀錄的資料要增加至主檔內
	- 刪除交易
		- 檔案中刪除的紀錄
	- 改變交易
		- 為了處理任何這些交易，你需要一個鍵值（key），它是一個或更多的欄位，唯一可用來識別在檔案中的資料。
- 錯誤報告檔
	- 當錯誤發生時，必須呈報給使用者。錯誤報告包含在更新過程期間所發現的所有錯誤的列表，以及提供使用者的更正動作。

![](https://i.imgur.com/tjEQKSd.png)

### 處理檔案更新

為了使更新過程有效率，所有檔案會以相同鍵值加以排序。
1. 如果交易檔的鍵值小於主檔的鍵值而且交易是一個新增，
	    則新增這個交易到新主檔中。
2. 如果交易檔的鍵值等於主檔的鍵值，則 a、b 兩者任一個：
a. 如果交易是改變 (C)，則改變主檔資料的內容。
b. 如果交易是刪除 (D)，則將資料從主檔中移除。
3. 如果交易檔的鍵值大於主檔的鍵值，將舊主檔紀錄寫入到
	    新主檔中。
4. 可能產生錯誤並被報告到錯誤檔中的一些例子：
a. 如果交易是新增一個已存在於舊主檔中的紀錄（同樣的鍵值）。
b. 如果交易是刪除或改變一個未存在於舊主檔中的紀錄。


![](https://i.imgur.com/mnFDxwi.png)


## 索引

為了去找我們要的資料，我們需要知道他的位址，而索引能將我們要的資料與位址連在一起，方便我們去尋找

![](https://i.imgur.com/uCFlFUY.png)

- 索引檔
	- 資料檔案(循環檔案)+索引
		- 索引：
			- 兩個欄位的小檔案
			- 以資料檔案的鍵值來排序
		- 循環檔案：
			- 鍵值和磁碟中相對應紀錄的位址
- 存取檔案順序
	- 載入整個索引檔到主記憶體中（此檔案很小，只使用少量記憶體）。
	- 用諸如二分搜尋法之有效搜尋演算法來搜尋索引條目，以找到所要的鍵值。
	- 記錄的位址被檢索到。
	- 利用此位址來檢索資料記錄並傳遞給使用者。

- 反轉檔
	- 有多個索引，每一個檔案都有不同鍵值
![](https://i.imgur.com/D5sWAVe.png)

## 雜湊檔

用一個數學函式來將值給弄亂，使用者提供鍵值，此函式將鍵值對應到位址並傳遞給作業系統，而把紀錄檢索出來。雜湊檔除去了額外檔案（索引）的需要。
![](https://i.imgur.com/asOwZLX.png)

### 方法
#### 直接雜湊法

鍵值就是位址而不需要任何算術處理。因此檔案必須為每一個可能的鍵值保留紀錄，雖然適合直接雜湊的情況是有限的，但是它可以是很有效的，因為它可以保證不會像其他方法會有同義詞或者碰撞的情況。

#### 模數除法之雜湊法
模數除法雜湊亦稱為取餘數除法雜湊（division remainder hashing） 。模數除法（modulo division）的方法將檔案大小除以鍵值並且將餘數加 1 當作位址。

![](https://i.imgur.com/Zrrw5Hw.png)

雖然這個演算法適用於任何大小的串列，但若串列大小為質數時，碰撞較不易發生。因此只要可以的話，盡量使檔案大小為質數。

#### 數字抽取雜湊法
使用數字抽取雜湊（digit extraction hashing）所選擇的數字是從鍵值中抽取出來並且用來當作位址。

![](https://i.imgur.com/eZMqZjA.png)

#### 其他雜湊方法
其他常見的方法有：中數平方法、摺疊法、旋轉法和虛擬隨機法。

### 碰撞

雜湊後的值，可能會產生有兩個相同值的結果(地址)，這種情形便是碰撞。


#### 碰撞之解決
碰撞有許多處理的方法，每一個方法都與雜湊演算法無關，亦即任何雜湊方法可以使用任何碰撞解決（collision resolution）方法。

#### 開放定址

開放定址解決法（open addressing resolution），它是在主要區域中解決碰撞問題。當碰撞發生時，搜尋主要區域中開放的或者未佔據的位址以便放置此新資料。解決不能在原始位址中儲存資料的一個簡單策略是在下一個位址中加以儲存（原始位址 +1）。

---

## 本文檔與二進位檔

